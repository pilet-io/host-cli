#!/bin/bash

function store_sys() {
  psql -U pilet -h pg.pilet.site -d system
}

function store_sys_csv() {
  psql -U pilet -h pg.pilet.site -d system --csv -t
}

# store_vm_add NAME PROFILE
function store_vm_add() {
  echo "SELECT system.add_vm('$SYS_HOSTNAME','$1','$2')" | store_sys_csv
}

# store_vm_add_ip NAME IPv4 IPv6
function store_vm_add_ip() {
  echo "UPDATE system.vm SET ipv4='$2',ipv6='$3' WHERE host='$SYS_HOSTNAME' AND name='$1'" | store_sys_csv
}

# store_vm_remove NAME
function store_vm_remove() {
  echo "SELECT system.remove_vm('$SYS_HOSTNAME','$1')" | store_sys
}

# store_get_vm_addr4 NAME
function store_get_vm_addr4() {
  echo "SELECT ipv4 FROM system.vm WHERE \
  host = '$SYS_HOSTNAME' AND name = '$1'  " | store_sys_csv
}

# store_get_vm_addr6 NAME
function store_get_vm_addr6() {
  echo "SELECT ipv6 FROM system.vm WHERE \
  host = '$SYS_HOSTNAME' AND name = '$1'  " | store_sys_csv
}


# store_vm_addr4 NAME HOST
function store_vm_addr4() {
  echo "SELECT ipv4 FROM system.vm WHERE \
  host = '$2' AND name = '$1'  " | store_sys_csv
}

function store_kv_set() {
  KEY=$1
  VALUE=$2
  echo "INSERT INTO system.kv (id,value) VALUES('$KEY','$VALUE') ON CONFLICT (id) DO UPDATE SET value = EXCLUDED.value" | store_sys
}

function store_kv_get() {
  KEY=$1
  echo "SELECT value FROM system.kv WHERE id = '$KEY'" | store_sys_csv
}